<!--
  © 2025 ArtsnCrabs / Toya Cramsey
  HOS Load Calculator PRO (PWA Version)
  All rights reserved.

  This software and its associated assets (HTML, CSS, JavaScript, design,
  service worker, manifest, icons, and logic) are protected under U.S.
  intellectual property laws. No part of this application may be copied,
  reproduced, modified, sold, or distributed without explicit written
  permission from the owner.

  PRO VERSION:
  - Same as Base version
  - Adds 70-Hr / 8-Day clock (ON DUTY + DRIVING)
-->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HOS Load Calculator PRO (Offline)</title>
<meta name="theme-color" content="#0f172a" />
<style>
  :root{
    --bg:#0b1020; --card:#111936; --ink:#e6ecff; --muted:#96a2c7;
    --accent:#3b82f6; --ok:#16a34a; --warn:#eab308; --late:#dc2626; --chip:#1f2a4d;
    --outline:#2b3a6b;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#0a0f1f, #0b0f2a 40%, #0a0f1f);
    color:var(--ink); font:500 16px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
    -webkit-font-smoothing:antialiased; padding:18px;
  }
  h1{font-size:20px;margin:0 0 12px}
  .sub{color:var(--muted); font-size:13px; margin:4px 0 16px}
  .grid{display:grid; gap:12px}
  .card{background:var(--card); border:1px solid var(--outline); border-radius:14px; padding:14px}
  .row{display:grid; gap:10px}
  .row.cols-2{grid-template-columns:1fr 1fr}
  .row.cols-3{grid-template-columns:1fr 1fr 1fr}
  .label{font-size:12px;color:var(--muted); margin-bottom:6px}
  input, select{
    width:100%; background:#0a1330; color:var(--ink);
    border:1px solid var(--outline); border-radius:12px; padding:10px 12px; outline:none;
  }
  input[type="range"]{height:36px; padding:0}
  .inline{display:flex; gap:8px; align-items:center}
  .btn{
    background:var(--accent); color:white; border:none; padding:10px 14px; border-radius:10px;
    font-weight:600; cursor:pointer
  }
  .mutebtn{background:#1b2447; color:var(--ink)}
  .capsule{
    display:flex; justify-content:space-between; align-items:center;
    background:var(--chip); border:1px solid var(--outline); border-radius:999px; padding:10px 14px;
    font-weight:600
  }
  .stat{padding:4px 10px; border-radius:999px; font-size:12px; font-weight:800}
  .ok{background:color-mix(in oklab, var(--ok) 25%, transparent); border:1px solid var(--ok)}
  .warn{background:color-mix(in oklab, var(--warn) 25%, transparent); border:1px solid var(--warn)}
  .late{background:color-mix(in oklab, var(--late) 25%, transparent); border:1px solid var(--late)}
  .note{color:var(--muted); font-size:12px}
  .hr{height:1px;background:var(--outline); margin:10px 0}
  .pill{background:#0c1537; padding:6px 10px; border-radius:999px; border:1px solid var(--outline); font-size:12px}
  .right{justify-content:flex-end}
  .stickyfoot{position:sticky; bottom:0; padding-top:10px; background:linear-gradient(180deg,transparent, rgba(11,15,32,.95) 30%);}
  .fab{
    position:fixed; right:16px; bottom:16px; z-index:9999;
    background:var(--ok); color:white; border:none; border-radius:999px;
    padding:14px 18px; font-weight:800; box-shadow:0 8px 24px rgba(0,0,0,.35); cursor:pointer;
  }
  .fab:active{transform:translateY(1px)}

  /* HOS clocks layout */
  .hos-section {
    margin-top: 18px;
    padding: 14px;
    border-radius: 14px;
    border: 1px solid var(--outline);
    background:#020617;
  }
  .hos-section h2 {
    margin: 0 0 10px;
    font-size: 16px;
  }
  .hos-clock-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(190px,1fr));
    gap: 10px;
    margin-bottom: 10px;
  }
  .hos-clock-card {
    padding: 10px;
    border-radius: 12px;
    border: 1px solid var(--outline);
    background:#0b1120;
  }
  .hos-time {
    font-size: 1.2rem;
    font-weight: 600;
    margin-top: 4px;
  }
  .hos-status {
    font-size: 11px;
    margin-top: 4px;
    color: var(--muted);
  }
  .hos-controls {
    display:flex;
    flex-direction:column;
    gap:6px;
    margin-top:8px;
  }
  .hos-status-buttons {
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    align-items:center;
    font-size:12px;
  }
  .hos-status-btn,
  #btn-reset-hos {
    padding:6px 10px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    background:#1f2937;
    color:#f9fafb;
    font-size:12px;
  }
  .hos-status-btn.active {
    outline:2px solid #10b981;
    background:#065f46;
  }
  #btn-reset-hos {
    background:#4b5563;
    font-size:11px;
  }
  .hos-expired {
    color:#f97373;
  }
  .hos-warning {
    color:#facc15;
  }

  /* Recent trips */
  .recent-list {
    margin-top:6px;
    font-size:12px;
  }
  .recent-trip {
    padding:6px 8px;
    border-radius:8px;
    border:1px solid var(--outline);
    margin-bottom:4px;
    background:#020617;
  }
  .recent-trip-title {
    font-weight:600;
    font-size:12px;
  }
  .recent-trip-meta {
    font-size:11px;
    color:var(--muted);
  }
  #clearTrips {
    margin-top:6px;
    padding:6px 10px;
    border-radius:999px;
    border:none;
    background:#4b5563;
    color:#f9fafb;
    font-size:11px;
    cursor:pointer;
  }

  .hos-disclaimer {
    margin-top: 18px;
    padding: 10px 12px;
    font-size: 11px;
    line-height: 1.4;
    border-top: 1px solid var(--outline);
    color: var(--muted);
    background:#020617;
  }
  .hos-disclaimer strong {
    display:block;
    margin-bottom:3px;
    text-transform:uppercase;
    letter-spacing:0.04em;
  }
</style>
<link rel="manifest" href="manifest.webmanifest" />
<link rel="icon" sizes="192x192" href="icons/icon-192.png">
<link rel="apple-touch-icon" href="icons/icon-180.png">
</head>
<body>
  <h1>HOS Load Calculator PRO (Offline)</h1>
  <div class="sub">Driver workflow: enter trip → check ETAs/PTAs → color status vs appointment.</div>

  <div class="grid">
    <div class="card">
      <div class="row cols-2">
        <div>
          <div class="label">TRIP ID</div>
          <div class="inline">
            <input id="tripId" placeholder="e.g., TEST001" />
            <button class="btn mutebtn" id="genId">Auto</button>
          </div>
        </div>
        <div>
          <div class="label">AVG (MPH) — 50 to 75</div>
          <div class="inline">
            <input id="mph" type="range" min="50" max="75" step="1" value="60" />
            <span class="pill"><span id="mphVal">60</span> MPH</span>
          </div>
        </div>
      </div>

      <div class="hr"></div>
      <div class="row">
        <div>
          <div class="label">TRIP START</div>
          <input id="tripStart" type="datetime-local" />
        </div>
      </div>

      <div class="row cols-3">
        <div>
          <div class="label">DEADHEAD MILES</div>
          <input id="deadhead" type="number" inputmode="decimal" min="0" placeholder="e.g., 100" />
        </div>
        <div>
          <div class="label">LOADED MILES</div>
          <input id="loaded" type="number" inputmode="decimal" min="0" placeholder="e.g., 500" />
        </div>
        <div>
          <div class="label">TOTAL MILES</div>
          <input id="total" type="number" readonly tabindex="-1" />
        </div>
      </div>

      <div class="hr"></div>

      <div class="row cols-2">
        <div>
          <div class="label">SHIPPER APPOINTMENT</div>
          <input id="shipperAppt" type="datetime-local" />
        </div>
        <div>
          <div class="label">SHIPPER STOP TYPE</div>
          <select id="shipperStop">
            <option value="DROP30">Drop 30</option>
            <option value="DROP60">Drop 60</option>
            <option value="LIVE60">Live 60</option>
            <option value="LIVE120">Live 120</option>
            <option value="BACKHAUL90">Backhaul 90</option>
          </select>
        </div>
      </div>

      <div class="row cols-2">
        <div>
          <div class="label">CONSIGNEE APPOINTMENT</div>
          <input id="consAppt" type="datetime-local" />
        </div>
        <div>
          <div class="label">CONSIGNEE STOP TYPE</div>
          <select id="consStop">
            <option value="DROP30">Drop 30</option>
            <option value="DROP60">Drop 60</option>
            <option value="LIVE60">Live 60</option>
            <option value="LIVE120">Live 120</option>
            <option value="BACKHAUL90">Backhaul 90</option>
          </select>
        </div>
      </div>

      <!-- FUEL STOP (Optional) -->
      <div class="row cols-2">
        <div>
          <div class="label">FUEL STOP (Optional)</div>
          <div class="inline">
            <input id="fuelEnabled" type="checkbox" />
            <span class="pill">On-duty — no drive / break</span>
          </div>
        </div>
        <div>
          <div class="label">FUEL TIME (MINUTES)</div>
          <input
            id="fuelMinutes"
            type="number"
            min="5"
            step="5"
            value="30"
            inputmode="numeric"
          />
        </div>
      </div>
      <!-- /FUEL STOP -->

      <div class="row cols-2">
        <div class="row cols-3">
          <!-- Enable fuel stop -->
          <div>
            <div class="label">FUEL STOP (Optional)</div>
            <div class="inline">
              <input id="fuelEnabled" type="checkbox" />
              <span class="pill">On-duty — no drive / break</span>
            </div>
          </div>

          <!-- Fuel time in minutes -->
          <div>
            <div class="label">FUEL TIME (MINUTES)</div>
            <input
              id="fuelMinutes"
              type="number"
              min="5"
              step="5"
              value="30"
              inputmode="numeric"
            />
          </div>

          <!-- NEW: Fuel timing location -->
          <div>
            <div class="label">FUEL TIMING</div>
            <select id="fuelWhen">
              <option value="before">Before shipper</option>
              <option value="afterShipper" selected>After shipper</option>
              <option value="afterConsignee">After consignee</option>
            </select>
          </div>
        </div>
      </div>
      <!-- /FUEL STOP -->

      <div class="stickyfoot">
        <div class="hr"></div>
        <div class="inline right">
          <button id="calc" class="btn">Calculate</button>
          <button id="reset" class="btn mutebtn">Reset</button>
        </div>
      </div>

    <div class="card" id="results" style="display:none">
      <div class="label">Driver Output</div>

      <div class="row">
        <div class="capsule" id="etaShCaps">
          <div>ETA TO SHIPPER</div>
          <div class="stat" id="etaShStat">—</div>
        </div>
        <div class="small note" id="etaShExplain"></div>
      </div>

      <div class="row">
        <div class="capsule">
          <div>PTA AFTER STOP</div>
          <div class="stat pill" id="ptaShVal">—</div>
        </div>
      </div>

      <div class="row">
        <div class="capsule" id="etaCoCaps">
          <div>ETA TO CONSIGNEE</div>
          <div class="stat" id="etaCoStat">—</div>
        </div>
        <div class="small note" id="etaCoExplain"></div>
      </div>

      <div class="row">
        <div class="capsule">
          <div>PTA AFTER CONSIGNEE</div>
          <div class="stat pill" id="ptaCoVal">—</div>
        </div>
      </div>

      <div class="hr"></div>
      <div class="note">
        • Auto 30-min rest break is included when total driving ≥ 8h.  
        • Long loads use 450 miles / 9-hr safety limit per day (11-hr legal ceiling) with 10-hr resets.  
        • Status colors compare ETA against the appointment (on-time ≤60m early = green; >60m early = yellow; ≥1m late = red).
      </div>
      <div class="note" style="margin-top:10px">
        © 2025 Toya Cramsey (ArtsnCrabs). All rights reserved. For guidance only — driver remains responsible for HOS compliance.
      </div>
    </div>
  </div>

  <!-- HOS clocks section (PRO: includes 70-Hr / 8-Day card) -->
  <section id="hos-clocks" class="hos-section">
    <h2>HOS Clocks</h2>

    <div class="hos-clock-grid">
      <!-- 14-Hour On-Duty Window -->
      <div class="hos-clock-card">
        <h3>14-Hr On-Duty Window</h3>
        <div id="duty-window-time" class="hos-time">14:00:00</div>
        <div id="duty-window-status" class="hos-status">Not started</div>
      </div>

      <!-- 11-Hr Drive Time -->
      <div class="hos-clock-card">
        <h3>11-Hr Drive Time</h3>
        <div id="drive-time" class="hos-time">11:00:00</div>
        <div id="drive-status" class="hos-status">Not started</div>
      </div>

      <!-- 8-Hr / 30-Min Break -->
      <div class="hos-clock-card">
        <h3>8-Hr / 30-Min Break</h3>
        <div id="break-clock-time" class="hos-time">08:00:00</div>
        <div id="break-clock-status" class="hos-status">
          Not started
        </div>
      </div>

      <!-- 70-Hr / 8-Day Clock -->
      <div class="hos-clock-card">
        <h3>70-Hr / 8-Day Clock</h3>
        <div id="weekly-70-time" class="hos-time">70:00:00</div>
        <div id="weekly-70-status" class="hos-status">
          Not started
        </div>
        <div style="margin-top:8px; font-size:11px; color:var(--muted);">
          Tracks total ON DUTY + DRIVING time over the last 8 days.
        </div>
        <button id="btn-reset-70" class="hos-status-btn" style="margin-top:8px; font-size:11px;">
          Reset 70-Hr (after legal 34-hr restart)
        </button>
      </div>
    </div>

    <div class="hos-controls">
      <div class="hos-status-buttons">
        <span>Duty Status:</span>
        <button data-status="ON_DUTY" class="hos-status-btn">On Duty (Not Driving)</button>
        <button data-status="DRIVING" class="hos-status-btn">Driving</button>
        <button data-status="BREAK" class="hos-status-btn">Break / Off Duty</button>
        <button data-status="OFF" class="hos-status-btn">Off (End Day)</button>
      </div>

      <button id="btn-reset-hos" class="hos-reset">
        Reset HOS (after legal 10-hr break)
      </button>
    </div>
  </section>

  <!-- Recent trips -->
  <section id="recent-trips" class="hos-section">
    <h2>Recent Trips (last 8)</h2>
    <div id="recentTripsList" class="recent-list note">
      No trips saved yet.
    </div>
    <button id="clearTrips">Clear recent trips</button>
  </section>

  <!-- Disclaimer -->
  <footer id="hos-disclaimer" class="hos-disclaimer">
    <strong>Disclaimer:</strong>
    <span>
      This HOS Load Calculator and its clocks are planning and training tools only.
      They do not replace your official ELD, paper log, or any FMCSA-required
      records. Calculations are based on general FMCSA 14-hour, 11-hour, and
      8-hour/30-minute rules and may not reflect all exceptions, split sleeper
      provisions, exemptions, company policies, or time zone differences. The
      driver and motor carrier remain fully responsible for complying with all
      applicable laws, regulations, and company rules at all times. Always follow
      your official log and FMCSA guidance if there is any conflict.
    </span>
  </footer>

  <!-- Floating Let’s Roll button (HOS clocks only) -->
  <button class="fab" id="btn-lets-roll">Let’s Roll</button>

<script>
(function(){
  "use strict";

  const $ = sel => document.querySelector(sel);
  const fmt = d => d ? new Intl.DateTimeFormat(undefined, {year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'}).format(d) : '—';
  const hours = h => h * 3600 * 1000;
  const minutes = m => m * 60 * 1000;

  const dwell = code => ({
    'DROP30': minutes(30),
    'DROP60': minutes(60),
    'LIVE60': minutes(60),
    'LIVE120': minutes(120),
    'BACKHAUL90': minutes(90)
  }[code] ?? 0);

  function statusClass(eta, appt){
    if(!eta || !appt) return {label: fmt(eta), cls: ''};
    const diffMin = Math.round((appt - eta)/60000);
    if(diffMin < 0){ return {label: fmt(eta) + ' • LATE', cls:'late'}; }
    if(diffMin > 60){ return {label: fmt(eta) + ' • TOO EARLY', cls:'warn'}; }
    return {label: fmt(eta) + ' • ON TIME', cls:'ok'};
  }

  // --- Recent trips storage helpers ---
  const RECENT_KEY = "hosRecentTrips_v2";
  let recentTrips = [];

  function loadRecentTrips(){
    try{
      const raw = localStorage.getItem(RECENT_KEY);
      if(!raw) return [];
      const arr = JSON.parse(raw);
      return Array.isArray(arr) ? arr : [];
    }catch(e){
      console.error("Recent trips load error", e);
      return [];
    }
  }

  function saveRecentTrips(){
    try{
      localStorage.setItem(RECENT_KEY, JSON.stringify(recentTrips));
    }catch(e){
      console.error("Recent trips save error", e);
    }
  }

  function renderRecentTrips(){
    const listEl = $('#recentTripsList');
    if(!listEl) return;
    if(!recentTrips.length){
      listEl.textContent = "No trips saved yet.";
      ret
